generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 사용자
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  level     Int      @default(1)
  exp       Int      @default(0)
  products  Product[]
  badges    UserBadge[]
  quests    UserQuest[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 상품
model Product {
  id                    String   @id @default(cuid())
  userId                String
  user                  User     @relation(fields: [userId], references: [id])
  name                  String
  sku                   String   @unique
  category              String
  supplier              String
  supplierPrice         Int
  salePrice             Int
  margin                Float
  shippingStrategy      String
  freeShippingThreshold Int?
  shippingFee           Int
  supplierShippingFee   Int
  supplierReturnFee     Int
  hasOptions            Boolean  @default(false)
  optionName            String?
  optionValues          Json?
  mainImage             String?
  additionalImages      Json?
  description           String?
  keywords              Json?
  tags                  Json?
  internalNote          String?
  internalTags          Json?
  kKotiScore            Int?
  status                String
  salesCount            Int      @default(0)
  lastSaleDate          DateTime?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

// 배지
model Badge {
  id          String   @id @default(cuid())
  name        String   @unique
  icon        String
  description String
  rarity      String
  condition   Json
  users       UserBadge[]
}

model UserBadge {
  id         String   @id @default(cuid())
  userId     String
  badgeId    String
  user       User     @relation(fields: [userId], references: [id])
  badge      Badge    @relation(fields: [badgeId], references: [id])
  unlockedAt DateTime @default(now())
  @@unique([userId, badgeId])
}

// 퀘스트
model Quest {
  id          String   @id @default(cuid())
  type        String
  title       String
  description String
  target      Int
  reward      Json
  users       UserQuest[]
}

model UserQuest {
  id          String   @id @default(cuid())
  userId      String
  questId     String
  user        User     @relation(fields: [userId], references: [id])
  quest       Quest    @relation(fields: [questId], references: [id])
  progress    Int      @default(0)
  completed   Boolean  @default(false)
  completedAt DateTime?
  date        DateTime @default(now())
  @@unique([userId, questId, date])
}

// 템플릿
model Template {
  id                    String   @id @default(cuid())
  userId                String
  name                  String
  supplier              String
  supplierShippingFee   Int
  supplierReturnFee     Int
  shippingStrategy      String
  freeShippingThreshold Int?
  shippingFee           Int
  naverCommissionRate   Float
  targetMargin          Float
  createdAt             DateTime @default(now())
}
